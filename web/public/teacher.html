<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Smart Lecture Hall Management System</title>
    <link rel="stylesheet" href="assets_3/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets_3/css/Cookie.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="assets_3/css/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets_3/css/css/Corporate-Footer-Clean.css">
    <link rel="stylesheet" href="assets_3/css/css/Hero-Features-Material-Design-Animation.css">
    <link rel="stylesheet" href="assets_3/css/css/Navbar-Right-Links-icons.css">
    <link rel="stylesheet" href="assets_3/css/css/Scroll-To-Top.css">
    <link rel="stylesheet" href="assets_3/css/css/Good-login-dropdown-menu-styles.css">
    <link rel="stylesheet" href="assets_3/css/css/Good-login-dropdown-menu.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
</head>

<body>
  <nav class="navbar navbar-light navbar-expand-md py-3">
    <div class="container">
      <img class="swing animated" src="assets_3/img/logo2.png?h=7be7f2a8f57da910a3d7068e0861b556" width="91" height="30">
      <img class="swing animated" src="assets_3/img/logo1.png?h=7be7f2a8f57da910a3d7068e0861b556" width="123" height="30">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <span class="pulse animated" style="font-size: 20px;">
          <strong>Smart Lecture Hall Management System</strong>
        </span>
      </a>
      <button data-bs-toggle="collapse" data-bs-target="#navcol-2" class="navbar-toggler">
        <span class="visually-hidden">Toggle navigation</span>
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navcol-2">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"></li>
          <li class="nav-item">
            <a class="nav-link" href="#tt">Timetable</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/pdf">Events</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" data-bss-hover-animate="flash" href="#BookLH">
              Book LH
              <span class="glow-ball"></span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" data-bss-hover-animate="flash" href="/feedback">
              Feedbacks Received
              <span class="glow-ball"></span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <style>
    .glow-ball {
      width: 20px;
      height: 20px;
      background-color: #fff;
      border-radius: 50%;
      position: absolute;
      top: -5px;
      right: -5px;
      opacity: 0;
      transition: all 0.3s ease-out;
      z-index: -1;
    }

    .nav-link:hover .glow-ball,
    .nav-link:focus .glow-ball,
    .nav-link:active .glow-ball,
    .nav-link.active .glow-ball {
      transform: scale(8);
      opacity: 1;
    }

    .pulse.animated {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.1);
      }

      100% {
        transform: scale(1);
      }
    }

    .swing.animated {
      animation: swing 1s ease-in-out infinite;
      transform-origin: center;
    }

    @keyframes swing {
      0% {
        transform: rotate(0deg);
      }

      20% {
        transform: rotate(15deg);
      }

      40% {
        transform: rotate(-10deg);
      }

      60% {
        transform: rotate(5deg);
      }

      80%{
        transform: rotate(-5deg);
        }
        100% {
          transform: rotate(0deg);
        }
      }
    </style>      
    <!-- upload time table section -->
    <section class="py-4 py-xl-5">
        <section class="py-4 py-xl-5">
            <section data-aos="fade" id="events" class="py-4 py-xl-5">
                <div class="container">
                    <div class="row d-flex justify-content-center">
                        <div class="col-md-8 col-lg-6 col-xl-5 col-xxl-4" data-bss-hover-animate="bounce">
                            <div class="card mb-5" data-bss-hover-animate="bounce">
                                <div class="card-body p-sm-5" data-aos="fade-down-right">
                                    <h3 class="text-center mb-4">Upload a file for timetable</h3>
                                    <div class="file-upload-wrapper"><input type="file" id="input-file-now" class="file-upload"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- upload timetable section end -->

                <!-- download time table section -->
                <section data-aos="fade" id="download-timetable" class="py-4 py-xl-5">
                    <div class="container">
                        <div class="row d-flex justify-content-center">
                            <div class="col-md-8 col-lg-6 col-xl-5 col-xxl-4" data-bss-hover-animate="bounce">
                                <div class="card mb-5" data-bss-hover-animate="bounce">
                                    <div class="card-body p-sm-5" data-aos="fade-down-right">
                                        <h3 class="text-center mb-4">Download Latest Timetable</h3>
                                        <button class="btn btn-primary" id="download-timetable-btn">Download</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- end of download table section -->

                <!-- booking lecturehall system -->
                <section class="py-4 py-xl-5">
                    <section data-aos="fade" id="BookLH" class="py-4 py-xl-5">
                      <div class="container">
                        <div class="row d-flex justify-content-center">
                          <div class="col-md-8 col-lg-6 col-xl-5 col-xxl-4" data-bss-hover-animate="bounce">
                            <div class="card mb-5" data-bss-hover-animate="bounce">
                              <div class="card-body p-sm-5" data-aos="fade-down-right">
                                <h3 class="text-center mb-4">Book a Lecture Hall</h3>
                                <form id="lhForm" enctype="multipart/form-data">
                                  <div class="mb-3"><input class="form-control form-control form-control" type="text" id="lh" name="lh" placeholder="Lecture Hall no."></div>
                                  <div class="mb-3"><input class="form-control form-control" type="name" id="teacherName" name="teacherName" placeholder="Teacher Name"></div>
                                  <div class="mb-3"><input class="form-control form-control" type="username" id="course" name="course" placeholder="Course"></div>
                                  <div class="mb-3"><input class="form-control form-control" type="message" id="explanation" name="explanation" placeholder="Explanation"></div>
                                  <div class="mb-3"><input class="form-control form-control" type="file" id="pdfFile" name="pdfFile"></div>
                                  <button class="btn btn-primary d-block w-100" data-bss-hover-animate="tada" type="submit" style="background: rgb(255, 13, 13);"> Send request </button>
                                </form>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </section>
                  </section>              
                  <!-- end of booking lecture hall system -->

                    <footer class="page-footer">
                        <div class="container">
                            <hr>
                            <div class="footer-legal"><button type="button" id="scroll-to-top" style="background: rgb(255, 13, 13);"><i class="fas fa-chevron-up"></i></button>
                                <div class="float-md-end region"></div>
                                <div class="d-inline-block copyright">
                                    <p class="d-inline-block" style="font-size: 14px;"> Smart Lecture Hall Management System Â© Divide And Conquer. All rights reserved. </p>
                                </div>
                                <div class="d-inline-block legal-links"></div>
                            </div>
                        </div>
                    </footer>
                </section>
            </section>
        </section>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script src="assets_3/js/bs-init-2.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script src="assets_3/js/bs-init-1.js"></script>
    <script src="assets_3/js/bs-init.js"></script>
    <script>


        $(document).ready(function() {
            $('#download-timetable-btn').click(function() {
              $.ajax({
                url: 'http://localhost:5004/timetable',
                method: 'GET',
                xhrFields: {
                  responseType: 'blob'
                },
                success: function(response) {
                  const filename = 'timetable.xlsx';
                  const blob = new Blob([response], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
          
                  if (typeof window.navigator.msSaveBlob !== 'undefined') {
                    window.navigator.msSaveBlob(blob, filename);
                  } else {
                    const downloadUrl = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = downloadUrl;
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                  }
          
                  alert('File downloaded successfully!');
                },
                error: function(error) {
                  alert('Error downloading file!');
                  console.log(error);
                }
              });
            });
          
            $('#input-file-now').change(function() {
              const file = this.files[0];
              if (file.type === 'application/vnd.ms-excel' || file.type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet') {
                const formData = new FormData();
                formData.append('file', file);
          
                $.ajax({
                  url: 'http://localhost:5004/timetable',
                  method: 'POST',
                  data: formData,
                  processData: false,
                  contentType: false,
                  success: function(response) {
                    alert('File uploaded successfully!');
                    console.log(response);
                    location.reload();
                  },
                  error: function(error) {
                    alert('Error uploading file!');
                    console.log(error);
                  }
                });
              } else {
                alert('Please select an Excel file.');
              }
            });
          });
          

        $(document).ready(function() {
            $('#lhForm').submit(function(event) {
              event.preventDefault();
              const lh = $('#lh').val();
              const teacherName = $('#teacherName').val();
              const course = $('#course').val();
              const explanation = $('#explanation').val();
              const pdfFile = $('#pdfFile').prop('files')[0];
              
              // Check if any field is empty
              if (lh.trim() === '' || teacherName.trim() === '' || course.trim() === '' || explanation.trim() === '' || !pdfFile) {
                alert('Please fill in all the fields and attach a PDF file.');
                return false;
              }
              
              const formData = new FormData();
              formData.append('lh', lh);
              formData.append('teacherName', teacherName);
              formData.append('course', course);
              formData.append('explanation', explanation);
              formData.append('pdfFile', pdfFile);
              $.ajax({
                url: 'http://localhost:5004/bookings',
                type: 'POST',
                data: formData,
                contentType: false,
                processData: false,
                timeout: 10000, // Set timeout to 10 seconds
                success: function(data) {
                  if (data.success) {
                    alert('succussfully booked lecture hall');
                  } else {
                    alert('succussfully booked lecture hall');
                  }
                },
                error: function(error) {
                  console.error('Error:', error);
                  alert('Error booking lecture hall! try again in a few seconds');
                }
              });
            });
          });
          
    </script>
</body>

</html>